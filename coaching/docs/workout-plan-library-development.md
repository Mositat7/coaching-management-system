## کتابخانه برنامه‌ها (Plan-library)

### هدف این بخش
- نمایش لیست برنامه‌های ذخیره‌شدهٔ مربی به‌صورت کارت‌های مرتب و قابل اسکن.
- فراهم کردن نقطهٔ شروع برای عملیات بعدی مثل مشاهده، ویرایش، ارسال به عضو و حذف.

---

### مسیرها و کنترلر

- **روت:** `GET /Plan-library` با نام `plans.library`
  - تعریف‌شده در `coaching/routes/web.php` داخل گروه `auth.coach`.
- **کنترلر:** `App\Http\Controllers\Admin\plans\PlanController::library()`

```php
public function library()
{
    $coachId = Session::get('coach_id');

    $plans = WorkoutPlan::with(['days.exercises'])
        ->when($coachId, fn ($q) => $q->where('coach_id', $coachId))
        ->latest()
        ->get();

    return view('admin.plans.library', [
        'plans' => $plans,
    ]);
}
```

**نکات:**
- فقط برنامه‌های همان مربی فعلی (بر اساس `Session::get('coach_id')`) نمایش داده می‌شوند.
- `with(['days.exercises'])` برای جلوگیری از N+1 و آماده‌داشتن شمارش روزها و تمرین‌هاست.

---

### ویو: `resources/views/admin/plans/library.blade.php`

#### آمار بالا
- چهار کارت خلاصه در بالای صفحه:
  - تعداد برنامه‌های ورزشی (`$plans->count()`).
  - آمار نمونه برای برنامه غذایی / محبوب / ارسال‌شده (در حال حاضر استاتیک و قابل توسعه بعدی).

#### نوار جستجو و فیلتر
- یک کارت جدا با:
  - اینپوت جستجو (`جستجوی برنامه...`) با آیکون ذره‌بین داخل `input-group`.
  - دکمهٔ فیلتر (`btn-outline-primary btn-sm`).
  - دو `select` کوچک برای فیلتر نوع برنامه و ترتیب مرتب‌سازی.
  - دکمهٔ «برنامه جدید» که به `route('plans.create')` (صفحهٔ ساخت برنامه) می‌رود.

#### لیست برنامه‌ها

```blade
@forelse($plans as $plan)
    @php
        $dayCount = $plan->days->count();
        $exerciseCount = $plan->days->sum(fn($d) => $d->exercises->count());
    @endphp
    <div class="col-xl-4 col-lg-6">
        <div class="card h-100 border-0 shadow-sm">
            <div class="card-body">
                <!-- هدر کارت: برچسب‌ها + منوی سه‌نقطه -->
                <!-- عنوان و توضیح کوتاه برنامه -->
                <!-- ردیف آمار: تعداد روز و تعداد تمرین -->
                <!-- فوتر: آخرین ویرایش + دکمه‌های مشاهده/ارسال -->
            </div>
        </div>
    </div>
@empty
    <!-- پیام خالی‌بودن کتابخانه -->
@endforelse
```

**جزئیات UI کارت:**
- **Badgeها:**
  - `ورزشی` به‌عنوان نوع (فعلاً ثابت).
  - تعداد روزها به‌صورت badge دوم (`{{ $dayCount }} روز`).
- **توضیح:** توضیح برنامه با `Str::limit` تا ۱۲۰ کاراکتر برای جلوگیری از شلوغی.
- **آمار:** در دو ستون کوچک:
  - تعداد روزهای تمرین (`{{ $dayCount }} روز تمرین`).
  - تعداد کل تمرین‌ها (`{{ $exerciseCount }} تمرین`).
- **فوتر کارت:**
  - سمت راست: متن کوچک «آخرین ویرایش» + تاریخ `updated_at` با فرمت `Y/m/d`.
  - سمت چپ: دکمه‌های کوچک:
    - «مشاهده» (برای آینده – صفحهٔ show فقط‌خواندنی).
    - «ارسال» برای اکشن اصلی (ارسال برنامه به عضو).

---

### ارتباط با بخش ساخت برنامه (`Workouts-add`)

- صفحهٔ ساخت برنامه (`/Workouts-add`) با متد `WorkoutsController::store()` برنامه را در جداول:
  - `workout_plans`
  - `workout_plan_days`
  - `workout_plan_day_exercises`
  ذخیره می‌کند.
- هر بار که برنامه‌ای ذخیره می‌شود، در `Plan-library` به‌صورت یک کارت جدید ظاهر می‌شود چون:
  - رکورد جدید `WorkoutPlan` با `coach_id` مربی فعلی ساخته می‌شود.
  - متد `library()` همیشه آخرین برنامه‌ها را با `->latest()` می‌کشد.

---

### نکات توسعه بعدی

- اضافه‌کردن امکان:
  - مشاهدهٔ جزئیات (`show`) برای هر برنامه.
  - ویرایش (`edit`) و حذف (`destroy`) از همین کارت‌ها.
- اتصال فیلترها و جستجو به کوئری `WorkoutPlan` (الان فقط UI آماده است).
- پشتیبانی از نوع‌های مختلف برنامه (مثلاً ورزشی/غذایی) با یک فیلد روی مدل و Badgeهای متفاوت.

